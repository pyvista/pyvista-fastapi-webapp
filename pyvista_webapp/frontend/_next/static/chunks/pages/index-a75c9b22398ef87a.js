(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(3866)}])},3866:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var n=r(5893),a=r(7294),l=r(9477),s=r(4311),i=r(5029),o=r(7210),c=r(4122),u=r(3467),d=r(8648),f=r(2371);function g(){return(0,n.jsx)(u.x,{enableNormalPass:!0,children:(0,n.jsx)(d.K,{blendFunction:f.YQ.MULTIPLY,samples:60,radius:.05,intensity:10})})}let y=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("ambientLight",{intensity:.5}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.7}),(0,n.jsx)("directionalLight",{position:[-10,10,-5],intensity:.7})]}),x=e=>{let{vertices:t,faces:r,visible:i,showEdges:c}=e,u=(0,a.useRef)(null),d=(0,a.useRef)(),{camera:f,scene:g}=(0,s.A)(),y=(0,o.B)();return(0,a.useEffect)(()=>{let e=new l.BufferGeometry,n=new l.MeshPhongMaterial({color:16777215,flatShading:!0,side:l.DoubleSide});if(e.setAttribute("position",new l.BufferAttribute(t,3)),e.setIndex(new l.BufferAttribute(r,1)),e.computeVertexNormals(),u.current&&(u.current.geometry.dispose(),u.current.geometry=e,u.current.material=n),c){let t=new l.EdgesGeometry(e,-0),r=new l.LineBasicMaterial({color:0,linewidth:1}),n=new l.LineSegments(t,r);d.current=n,g.add(n)}e.computeBoundingBox();let a=e.boundingBox;if(a){let t=new l.Vector3;a.getCenter(t),e.center()}y.refresh().clip().fit(),u.current&&g.add(u.current)},[t,r,y,g,c]),(0,a.useEffect)(()=>{u.current&&(u.current.visible=i,d.current&&c&&(d.current.visible=i))},[i,c]),(0,n.jsx)("mesh",{ref:u})};var h=e=>{let{surfaceData:t}=e,[r,u]=(0,a.useState)(!0),[d,f]=(0,a.useState)(!1),h=t.vertices&&t.vertices.length>0;return(0,n.jsxs)(i.Xz,{children:[(0,n.jsx)(()=>{let{scene:e}=(0,s.A)();return(0,a.useEffect)(()=>{e.children.filter(e=>!(e instanceof l.Light)).forEach(t=>{"function"==typeof t.dispose&&t.dispose(),e.remove(t)})},[,e]),null},{}),(0,n.jsx)("perspectiveCamera",{}),(0,n.jsx)(y,{}),(0,n.jsx)(c.$,{rotateSpeed:3}),(0,n.jsx)(o.Y,{fit:!0,clip:!0,observe:!0,margin:1.2,children:h&&(0,n.jsx)(x,{vertices:t.vertices,faces:t.faces,visible:r,showEdges:!1})}),(0,n.jsx)(g,{})]})},w=r(5121),b=e=>{let{open:t,title:r,progress:a}=e;return t?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 overflow-auto flex",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black opacity-50"}),(0,n.jsxs)("div",{className:"relative p-8 bg-white w-full max-w-md m-auto flex-col flex rounded-lg",children:[(0,n.jsx)("div",{className:"text-lg font-medium",children:r}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full dark:bg-gray-700 my-2",children:(0,n.jsxs)("div",{className:"bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full",style:{width:"".concat(a,"%")},children:[" ",a.toFixed(0),"%"," "]})})]})]}):null},p=r(6833),m=r(8476),j=r(4479);let v=e=>{var t,r;let n=e.attributes.position.array,a=e.attributes.position.count,l=null!==e.index,s=new Int32Array(l?null!==(r=null===(t=e.index)||void 0===t?void 0:t.array)&&void 0!==r?r:[]:0),i=4+n.byteLength+s.byteLength,o=new ArrayBuffer(i);new DataView(o).setInt32(0,a,!0);let c=4;return new Float32Array(o,c,n.length).set(n),c+=n.byteLength,new Int32Array(o,c,s.length).set(s),o},A=async(e,t)=>{let r="".concat((0,p.l)(),"/gen-tetra");try{return(await w.Z.post(r,e,{headers:{"Content-Type":"application/octet-stream"},responseType:"arraybuffer",onUploadProgress:e=>{if(null===e.total||void 0===e.total)return;let r=Math.round(100*e.loaded/e.total/4+50);t(r)}})).data}catch(e){throw Error("Failed to send geometry data to backend: ".concat(e))}};var N=e=>{let{setSurfaceData:t}=e,[r,l]=(0,a.useState)(!1),[s,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)("Uploading"),[u,d]=(0,a.useState)(null),f=(0,a.useRef)(null),[g,y]=(0,a.useState)(0),x=async()=>{try{let e=(await w.Z.get("".concat((0,p.l)(),"/get-demo"),{responseType:"arraybuffer"})).data,r=new DataView(e).getUint32(0,!0),n=new Float32Array(e,4,3*r),a=new Uint32Array(e,4+12*r);t({vertices:n,faces:a})}catch(e){throw Error("Failed to get aero bracket: ".concat(e))}},h=async e=>{let r=v(e);c("Uploading and Generating Tetrahedra");let n=await A(r,y);try{let e=new DataView(n).getUint32(0,!0),r=new Float32Array(n,4,3*e),a=new Uint32Array(n,4+12*e);t({vertices:r,faces:a})}catch(e){console.error("Failed to fetch surface data:",e)}y(100),i(!1)},N=e=>{if(!e)return;i(!0),c("Processing"),y(0),console.log("starting...");let t=new FileReader;t.onload=async t=>{null!==t.target&&(t.target.result,(e.name.endsWith(".stl")?new m.j:new j.F).load(URL.createObjectURL(e),e=>{h(e),console.log("loaded",e)},e=>{e.lengthComputable&&y(Math.round(e.loaded/e.total*50))},e=>{console.error("Error loading file",e),i(!1)}))},t.readAsArrayBuffer(e),console.log("called")},S=async()=>{setTimeout(()=>{null!==f.current&&f.current.click()},0)},E=async()=>{t({vertices:new Float32Array,faces:new Uint32Array})};return(0,n.jsxs)("div",{className:"relative inline-block text-left p-4",children:[(0,n.jsxs)("div",{className:"flex justify-start items-center",children:[(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-lg px-4 py-2 bg-white text-base text-gray-700 hover:bg-gray-100 mr-2",style:{whiteSpace:"nowrap",textAlign:"center"},onClick:S,children:"Import Surface"}),(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-lg px-4 py-2 bg-white text-base text-gray-700 hover:bg-gray-100 mr-2",style:{whiteSpace:"nowrap",textAlign:"center"},onClick:x,children:"Demo - Cube"}),(0,n.jsx)("button",{type:"button",className:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-lg px-4 py-2 bg-white text-base text-gray-700 hover:bg-gray-100 mr-2",onClick:E,children:"Clear"})]}),(0,n.jsx)("input",{type:"file",onChange:e=>{null!==e.target.files&&e.target.files.length>0&&(console.log("file ".concat(e.target.files[0]," selected")),d(e.target.files[0]),N(e.target.files[0]),e.target.value="")},style:{display:"none"},ref:f,accept:".stl,.ply"}),(0,n.jsx)(b,{open:s,title:o,progress:g})]})},S=()=>{let[e,t]=(0,a.useState)({vertices:new Float32Array,faces:new Uint32Array});return(0,n.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,n.jsx)("div",{className:"flex justify-between items-center w-full z-10 absolute",children:(0,n.jsx)(N,{setSurfaceData:t})}),(0,n.jsx)(h,{surfaceData:e})]})}}},function(e){e.O(0,[737,782,724,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);